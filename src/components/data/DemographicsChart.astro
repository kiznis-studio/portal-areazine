---
interface Props {
  demographics: Record<string, number>;
  hispanicPct?: number | null;
}

const { demographics, hispanicPct } = Astro.props;

const DEMO_COLORS: Record<string, string> = {
  white: 'var(--color-data-blue)',
  black: 'var(--color-data-teal)',
  asian: 'var(--color-data-amber)',
  other: 'var(--color-data-slate)',
};

const DEMO_LABELS: Record<string, string> = {
  white: 'White',
  black: 'African American',
  asian: 'Asian',
  other: 'Other / Multiracial',
};

const entries = Object.entries(demographics)
  .filter(([key, pct]) => pct > 0 && key !== 'hispanic')
  .sort(([, a], [, b]) => b - a);
---

<div>
  <div class="demo-bar mb-3">
    {entries.map(([group, pct]) => (
      <div
        class="demo-bar-segment"
        style={`width: ${pct}%; background: ${DEMO_COLORS[group] || 'var(--color-data-slate)'};`}
        title={`${DEMO_LABELS[group] || group}: ${pct}%`}
      />
    ))}
  </div>
  <div class="flex flex-wrap gap-x-4 gap-y-1">
    {entries.map(([group, pct]) => (
      <div class="flex items-center gap-1.5 text-xs">
        <span
          class="w-2.5 h-2.5 rounded-sm flex-shrink-0"
          style={`background: ${DEMO_COLORS[group] || 'var(--color-data-slate)'};`}
        />
        <span class="text-[var(--color-muted)]">{DEMO_LABELS[group] || group}</span>
        <span class="font-semibold tabular-nums">{pct}%</span>
      </div>
    ))}
  </div>
  {hispanicPct && hispanicPct > 0 && (
    <div class="mt-2 pt-2 border-t border-[var(--color-border)]">
      <div class="flex items-center gap-1.5 text-xs">
        <span class="w-2.5 h-2.5 rounded-sm flex-shrink-0" style="background: var(--color-data-rose);" />
        <span class="text-[var(--color-muted)]">Hispanic or Latino</span>
        <span class="font-semibold tabular-nums">{hispanicPct}%</span>
        <span class="text-[var(--color-muted)] opacity-60 text-[10px]">(ethnicity, any race)</span>
      </div>
    </div>
  )}
</div>
