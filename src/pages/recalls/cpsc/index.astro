---
import { getCollection } from 'astro:content';
import Base from '../../../layouts/Base.astro';
import ArticleCard from '../../../components/ArticleCard.astro';
import { getCategoryMeta } from '../../../lib/config';
import type { CategoryKey } from '../../../lib/config';

const category: CategoryKey = 'recalls-cpsc';
const meta = getCategoryMeta(category);
const title = 'Latest CPSC Product Recalls';
const description = 'Today\'s consumer product safety recalls from the CPSC. Affected products, hazards, and what to do â€” updated daily.';

const articles = (await getCollection('articles'))
  .filter((a) => a.data.category === category)
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime());
---

<Base title={title} description={description}>
  <div class="container py-8 md:py-12">
    <header class="mb-8 pb-8 border-b border-[var(--color-border)]">
      <nav class="flex items-center gap-2 text-sm text-[var(--color-muted)] mb-4">
        <a href="/" class="hover:text-[var(--color-foreground)]">Home</a>
        <span>/</span>
        <a href="/recalls" class="hover:text-[var(--color-foreground)]">Recalls</a>
        <span>/</span>
        <span>CPSC</span>
      </nav>
      <h1 class="text-2xl md:text-3xl font-bold mb-3">{title}</h1>
      <p class="text-lg text-[var(--color-muted)] max-w-2xl">
        Consumer product recalls issued by CPSC, covering toys, electronics, household goods, and more.
      </p>
    </header>

    <div class="space-y-3">
      {articles.map((article) => (
        <ArticleCard
          title={article.data.title}
          summary={article.data.summary}
          href={`/${meta.slug}/${article.id}`}
          category={category}
          sourceAgency={article.data.sourceAgency}
          publishedAt={new Date(article.data.publishedAt)}
          severity={article.data.severity}
        />
      ))}
    </div>

    {articles.length === 0 && (
      <p class="text-[var(--color-muted)] text-center py-12">
        No CPSC recall articles available yet. Check back soon.
      </p>
    )}
  </div>

  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://areazine.com/" },
      { "@type": "ListItem", "position": 2, "name": "Recalls", "item": "https://areazine.com/recalls/" },
      { "@type": "ListItem", "position": 3, "name": "CPSC" }
    ]
  })} />
</Base>
