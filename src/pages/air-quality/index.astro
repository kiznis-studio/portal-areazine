---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { getCategoryMeta } from '../../lib/config';
import type { CategoryKey } from '../../lib/config';

const category: CategoryKey = 'air-quality';
const meta = getCategoryMeta(category);
const title = 'Air Quality Alerts';
const description = 'Real-time air quality reports for major U.S. metro areas. AQI levels, pollutant breakdowns, and health guidance from EPA AirNow data.';

const articles = (await getCollection('articles'))
  .filter((a) => a.data.category === category)
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime());
---

<Base title={title} description={description}>
  <div class="container py-8 md:py-12">
    <header class="mb-8 pb-8 border-b border-[var(--color-border)]">
      <nav class="flex items-center gap-2 text-sm text-[var(--color-muted)] mb-4">
        <a href="/" class="hover:text-[var(--color-foreground)]">Home</a>
        <span>/</span>
        <span>Air Quality</span>
      </nav>
      <h1 class="text-2xl md:text-3xl font-bold mb-3">{title}</h1>
      <p class="text-lg text-[var(--color-muted)] max-w-2xl">
        Air quality alerts for U.S. metro areas when AQI exceeds unhealthy levels. Based on real-time EPA AirNow monitoring data.
      </p>
    </header>

    <div class="space-y-3">
      {articles.map((article) => (
        <ArticleCard
          title={article.data.title}
          summary={article.data.summary}
          href={`/air-quality/${article.id}`}
          category={category}
          sourceAgency={article.data.sourceAgency}
          publishedAt={new Date(article.data.publishedAt)}
          severity={article.data.severity}
          location={article.data.location}
        />
      ))}
    </div>

    {articles.length === 0 && (
      <p class="text-[var(--color-muted)] text-center py-12">
        No air quality alerts right now â€” that's good news. Alerts appear when AQI exceeds unhealthy levels in major metro areas.
      </p>
    )}
  </div>

  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://areazine.com/" },
      { "@type": "ListItem", "position": 2, "name": "Air Quality" }
    ]
  })} />
</Base>
