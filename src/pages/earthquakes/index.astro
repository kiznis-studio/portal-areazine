---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { getCategoryMeta } from '../../lib/config';
import type { CategoryKey } from '../../lib/config';

const category: CategoryKey = 'earthquakes';
const meta = getCategoryMeta(category);
const title = 'Earthquake Reports';
const description = 'Recent earthquake activity and seismic events from the U.S. Geological Survey (USGS).';

const articles = (await getCollection('articles'))
  .filter((a) => a.data.category === category)
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime());
---

<Base title={title} description={description}>
  <div class="container py-8 md:py-12">
    <header class="mb-8 pb-8 border-b border-[var(--color-border)]">
      <nav class="flex items-center gap-2 text-sm text-[var(--color-muted)] mb-4">
        <a href="/" class="hover:text-[var(--color-foreground)]">Home</a>
        <span>/</span>
        <span>Earthquakes</span>
      </nav>
      <h1 class="text-2xl md:text-3xl font-bold mb-3">{title}</h1>
      <p class="text-lg text-[var(--color-muted)] max-w-2xl">
        Significant earthquake activity reported by the USGS Earthquake Hazards Program, covering events M3.0 and above.
      </p>
    </header>

    <div class="space-y-3">
      {articles.map((article) => (
        <ArticleCard
          title={article.data.title}
          summary={article.data.summary}
          href={`/earthquakes/${article.id}`}
          category={category}
          sourceAgency={article.data.sourceAgency}
          publishedAt={new Date(article.data.publishedAt)}
          severity={article.data.severity}
          location={article.data.location}
        />
      ))}
    </div>

    {articles.length === 0 && (
      <p class="text-[var(--color-muted)] text-center py-12">
        No earthquake articles available yet. Check back soon.
      </p>
    )}
  </div>

  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://areazine.com/" },
      { "@type": "ListItem", "position": 2, "name": "Earthquakes" }
    ]
  })} />
</Base>
